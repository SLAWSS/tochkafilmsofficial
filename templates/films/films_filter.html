{% extends 'films/base.html' %}
{% load static %}

{% block title %}–§–∏–ª—å—Ç—Ä —Ñ–∏–ª—å–º–æ–≤ - TochkaFilms{% endblock %}

{% block content %}
<div class="container">
    <h1>üîç –§–∏–ª—å—Ç—Ä —Ñ–∏–ª—å–º–æ–≤</h1>
    
    <div class="filter-form">
        <form method="get" class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label>–ì–æ–¥ –æ—Ç:</label>
                    <input type="number" name="year_from" value="{{ current_filters.year_from }}" min="1900" max="2030" placeholder="1990">
                </div>
                <div class="filter-group">
                    <label>–ì–æ–¥ –¥–æ:</label>
                    <input type="number" name="year_to" value="{{ current_filters.year_to }}" min="1900" max="2030" placeholder="2024">
                </div>
                <div class="filter-group">
                    <label>–†–µ–π—Ç–∏–Ω–≥ –æ—Ç:</label>
                    <input type="number" name="rating_from" value="{{ current_filters.rating_from }}" min="0" max="10" step="0.1" placeholder="7.0">
                </div>
            </div>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select name="category">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if current_filters.category == category.id|stringformat:"s" %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                    <select name="sort">
                        <option value="-rating" {% if current_filters.sort == "-rating" %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üì</option>
                        <option value="rating" {% if current_filters.sort == "rating" %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üë</option>
                        <option value="-year" {% if current_filters.sort == "-year" %}selected{% endif %}>–ü–æ –≥–æ–¥—É ‚Üì</option>
                        <option value="year" {% if current_filters.sort == "year" %}selected{% endif %}>–ü–æ –≥–æ–¥—É ‚Üë</option>
                        <option value="title" {% if current_filters.sort == "title" %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é ‚Üë</option>
                        <option value="-title" {% if current_filters.sort == "-title" %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é ‚Üì</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button type="submit" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    <a href="{% url 'films:films_filter' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                </div>
            </div>
        </form>
    </div>

    <div class="results-info">
        <p>–ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤: {{ page_obj.paginator.count }}</p>
    </div>

    <div class="film-grid">
        {% for film in page_obj %}
        <div class="film-card">
            {% if film.trailer_url %}
                {% if 'vk.com' in film.trailer_url %}
                    <div class="russian-badge vk-badge">VK</div>
                {% elif 'rutube.ru' in film.trailer_url %}
                    <div class="russian-badge rutube-badge">RuTube</div>
                {% endif %}
            {% endif %}
            <a href="{% url 'films:film_detail' film.pk %}">
                {% if film.poster %}
                    <img src="{{ film.poster.url }}" alt="{{ film.title }}">
                    {% if film.trailer_url %}
                        <div class="play-overlay"></div>
                    {% endif %}
                {% else %}
                    <div class="no-poster">{{ film.title }}</div>
                {% endif %}
                <div class="film-info">
                    <h3>{{ film.title }}</h3>
                    <p>{{ film.year }} | <span class="rating-stars">‚≠ê {{ film.rating }}</span></p>
                </div>
            </a>
        </div>
        {% empty %}
        <p>–ü–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% for key, value in current_filters.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}">&laquo; –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ page_obj.previous_page_number }}{% for key, value in current_filters.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}
        
        <span class="current-page">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% for key, value in current_filters.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–°–ª–µ–¥—É—é—â–∞—è</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% for key, value in current_filters.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}">–ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}