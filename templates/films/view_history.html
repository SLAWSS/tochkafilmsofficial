{% extends 'films/base.html' %}
{% load static %}

{% block title %}–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ - TochkaFilms{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üì∫ –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h1>
        <div class="header-actions">
            <form method="post" action="{% url 'films:clear_history' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?')">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                </button>
            </form>
        </div>
    </div>

    {% if page_obj %}
        <div class="results-info">
            <p>–í—Å–µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ: {{ page_obj.paginator.count }} —Ñ–∏–ª—å–º–æ–≤</p>
        </div>

        <div class="history-list">
            {% for history_item in page_obj %}
            <div class="history-item">
                <div class="history-poster">
                    {% if history_item.film.poster %}
                        <img src="{{ history_item.film.poster.url }}" alt="{{ history_item.film.title }}">
                    {% endif %}
                </div>
                <div class="history-info">
                    <h3>
                        <a href="{% url 'films:film_detail' history_item.film.pk %}">{{ history_item.film.title }}</a>
                    </h3>
                    <p>{{ history_item.film.year }} | <span class="rating-stars">‚≠ê {{ history_item.film.rating }}</span></p>
                    <p class="history-description">{{ history_item.film.description|truncatewords:20 }}</p>
                    <div class="history-date">
                        –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ: {{ history_item.viewed_at|date:"d.m.Y H:i" }}
                    </div>
                </div>
                <div class="history-actions">
                    {% if history_item.film.trailer_url %}
                        <a href="{% url 'films:film_detail' history_item.film.pk %}#trailer" class="btn btn-small">
                            –¢—Ä–µ–π–ª–µ—Ä üá∑üá∫
                        </a>
                    {% endif %}
                    <a href="{% url 'films:film_detail' history_item.film.pk %}" class="btn btn-small">
                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; –ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ page_obj.previous_page_number }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}
            
            <span class="current-page">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>
            
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">–°–ª–µ–¥—É—é—â–∞—è</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
            {% endif %}
        </div>
        {% endif %}

    {% else %}
        <div class="empty-state">
            <div class="empty-icon">üì∫</div>
            <h2>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h2>
            <p>–í—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ —Ñ–∏–ª—å–º—ã. –ù–∞—á–Ω–∏—Ç–µ —Å <a href="{% url 'films:home' %}">–≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</a>!</p>
        </div>
    {% endif %}
</div>
{% endblock %}